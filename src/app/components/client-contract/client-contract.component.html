<div class="page-container">
  <p-toast />
  <p-confirmDialog></p-confirmDialog>
  <app-card-base width="auto" height="auto" header="CONTRATOS">
    <div class="btn-to-create-another-contract">
      <p-button
        [rounded]="true"
        [raised]="true"
        (onClick)="navigateToInfoClient()"
        icon="pi pi-arrow-left"
        severity="danger"
        size="large"
      />
      <p-button
        [raised]="true"
        label="LanÃ§ar Contrato"
        (onClick)="navigateToCreatContract()"
        icon="pi pi-dollar"
        severity="success"
      />
    </div>

    <div class="infolegends">
      <p><span class="status-dot active"></span> Ativo</p>
      <p><span class="status-dot waiting"></span> Aguardando InstalaÃ§Ã£o</p>
      <p><span class="status-dot canceled"></span> Cancelado</p>
      <p><span class="status-dot blocked"></span> Bloqueado</p>
      <p><span class="status-dot transfer"></span> Transferido</p>
      <p>
        <span class="pi pi-exclamation-circle icon-suspense"></span> Suspenso
      </p>
    </div>

    <div class="headerlist">
      <div class="search-wrapper">
        <input
          pInputText
          type="text"
          [mask]="'0000000'"
          placeholder="NÂº Contrato do RBX"
          [(ngModel)]="searchCode"
          (keydown.enter)="searchContractByRbxCode()"
        />
        <p-button
          label="ğŸ”"
          severity="warn"
          [rounded]="true"
          (onClick)="searchContractByRbxCode()"
        ></p-button>
      </div>

      <p-button
        [raised]="true"
        label="Somente Ativos"
        (onClick)="listActivesContracts()"
        icon="pi pi-list"
        severity="info"
      />
      <p-button
        [raised]="true"
        label="Visualizar todos"
        (onClick)="listToAllContracts()"
        icon="pi pi-list"
        severity="secondary"
      />
      <p-button
        [raised]="true"
        label="Bloqueados"
        (onClick)="listBlockedsContracts()"
        icon="pi pi-list"
        severity="secondary"
      />
      <p-button
        [raised]="true"
        label="Transferidos"
        (onClick)="listTransferContracts()"
        icon="pi pi-list"
        severity="secondary"
      />
    </div>

    <div class="contracts-list">
      @if (contracts.length === 0) {
      <div class="no-contracts">
        ğŸš« NÃƒO HÃ CONTRATOS CADASTRADO COM ESSE STATUS ğŸš«
      </div>
      } @else { @for (contract of contracts; track $index) {
      <div class="contract-card">
        <div class="contract-info">
          <div class="wrapper status-wrapper">
            <div class="status">
              <span
                class="status-dot"
                [ngClass]="{
                  active: contract.situationDescription == 'ATIVO',
                  waiting: contract.situationDescription == 'AGUARDANDO_INSTALACAO',
                  blocked: contract.situationDescription == 'BLOQUEADO',
                  transfer: contract.situationDescription == 'TRANSFERIDO',
                  suspense: contract.situationDescription == 'SUSPENSO',
                }"
              ></span>
              <label
                >[{{ contract.situationDescription }}] NÂ° Contrato ğŸ“œ (RBX)
                â†’</label
              >
              <span>{{ contract.codeContractRbx }}</span>

              <i
                *ngIf="contract?.suspensionScheduled == 1"
                class="pi pi-exclamation-circle suspension-alert-icon"
                pTooltip="SuspensÃ£o agendada para o contrato!"
                tooltipPosition="top"
              ></i>
            </div>
          </div>
          <div class="addresscontract">
            <!-- Plano -->
            <div class="section">
              <label>ğŸ“¦ Plano:</label>
              <span>{{ contract.planId }} | {{ contract.planName }}</span>
            </div>

            <!-- EndereÃ§o -->
            <div class="section">
              <label>ğŸ“ EndereÃ§o:</label>
              <span>{{ contract.street }}, {{ contract.number }}</span>
            </div>

            <!-- Bairro e CEP -->
            <div class="section">
              <label>ğŸ˜ï¸ Bairro:</label>
              <span>{{ contract.neighborhood }}</span>
              <label>ğŸ“ª CEP:</label>
              <span>{{ contract.zipCode }}</span>
              <label>ğŸŒ† Cidade:</label>
              <span>{{ contract.city }}, {{ contract.state }}</span>
            </div>

            <div class="section-inline">
              <div class="group">
                <label>VigÃªncia:</label>
                <span>{{ contract.vigencia }} </span>
              </div>

              <div class="group">
                <label>Dia Base:</label>
                <span>{{ contract.cicleBillingDayBase }}</span>
              </div>

              <div class="group">
                <label>Dia Vencimento:</label>
                <span>{{ contract.cicleBillingExpired }}</span>
              </div>

              <div class="group">
                <label>ğŸ’µ AdesÃ£o:</label>
                <span>{{ contract.adesion | currency : "BRL" }}</span>
              </div>
            </div>

            <!-- Valores -->
            <div class="section">
              <label>ğŸ’° Valor Bruto:</label>
              <span>{{ contract.brutePrice | currency : "BRL" }}</span>
              <label>ğŸ’¸ Desconto:</label>
              <span>{{ contract.descountFixe | currency : "BRL" }}</span>
              <label>ğŸ’µ Valor LÃ­quido:</label>
              <span>{{ contract.liquidPrice | currency : "BRL" }}</span>
            </div>

            <div class="section">
              <label>InÃ­cio:</label>
              <span>{{ contract.dateStart | date : "dd/MM/yyyy" }}</span>

              <label>Assinatura:</label>
              <span>{{ contract.dateSignature | date : "dd/MM/yyyy" }}</span>
            </div>
          </div>
        </div>
        <div class="contract-buttons">
          <div class="contract-actions">
           <p-button
              icon="pi pi-home"
              (onClick)="navigateToAddressTransfer(contract)"
              severity="warn"
              [rounded]="true"
              [text]="true"
              pTooltip="Transferir EndereÃ§o"
              tooltipPosition="top"
              [disabled]="contract.situationDescription !== 'ATIVO'"
            />
            <p-button
              icon="pi pi-check-circle"
              (onClick)="navigateToActivateContract(contract)"
              severity="success"
              [rounded]="true"
              [text]="true"
              pTooltip="Ativar Contrato Suspenso"
              tooltipPosition="top"
              [disabled]="contract.situationDescription !== 'SUSPENSO'"
            />
          </div> 
          <div class="contract-actions" > 
            <p-button
              icon="pi pi-arrow-down"
              (onClick)="handleOpenDialogValidation(contract, false)"
              severity="danger"
              [rounded]="true"
              [text]="true"
              pTooltip="Fazer Downgrade"
              tooltipPosition="top"
              [disabled]="contract.situationDescription !== 'ATIVO'"
            />
            <p-button
              icon="pi pi-arrow-up"
              (onClick)="handleOpenDialogValidation(contract, true)"
              severity="success"
              [rounded]="true"
              [text]="true"
              pTooltip="Fazer Upgrade"
              tooltipPosition="top"
              [disabled]="contract.situationDescription !== 'ATIVO'"
            />
          </div>
          <div class="contract-actions">
            <p-button
              icon="pi pi-calendar"
              (onClick)="goToAlterDateExpired(contract)"
              severity="success"
              [rounded]="true"
              [text]="true"
              pTooltip="Alterar Vencimento"
              tooltipPosition="top"
              [disabled]="contract.situationDescription !== 'ATIVO'"
            />
            <p-button
              icon="pi pi-users"
              (onClick)="navigateToTransferOwnership(contract)"
              severity="info"
              [rounded]="true"
              [text]="true"
              pTooltip="Transferir Titularidade"
              tooltipPosition="top"
              [disabled]="contract.situationDescription !== 'ATIVO'"
            />
           
          </div>
          <div class="contract-actions">
               <p-button
              icon="pi pi-times"
              (onClick)="navigateToCancelContract(contract)"
              severity="danger"
              [rounded]="true"
              [text]="true"
              pTooltip="Cancelar Contrato"
              tooltipPosition="top"
              [disabled]="contract.situationDescription !== 'ATIVO'"
            />
          </div>
          <div class="contract-actions">
            <p-button  
              icon="pi pi-file-excel"
              (onClick)="navigateToSuspension(contract)"
              severity="contrast" 
              [rounded]="true"
              [text]="true"
              pTooltip="SuspenÃ§Ã£o do Contrato"
              tooltipPosition="top"
              [disabled]="contract.situationDescription !== 'ATIVO'"
            />
            <p-button  
              icon="pi pi-stopwatch"
              (onClick)="navigateToCancelSuspension(contract)"
              severity="help" 
              [rounded]="true"
              [text]="true"
              pTooltip="Cancelar agendamento da SuspenÃ§Ã£o"
              tooltipPosition="top"
              [disabled]="contract?.suspensionScheduled == 0 || contract?.situationDescription !== 'ATIVO'"
            />
          </div> 
        </div>
      </div>
      } }
    </div>
  </app-card-base>
</div>
