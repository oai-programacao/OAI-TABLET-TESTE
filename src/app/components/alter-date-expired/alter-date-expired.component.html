<div class="page-container">
  <app-card-base header="Alterar Data de Pagamento" width="auto" height="auto">
    <div class="btn-to-back">
      <p-button
        icon="pi pi-arrow-left"
        [rounded]="true"
        severity="danger"
        raised="true"
        size="large"
        (onClick)="voltarParaCliente()"
      />

      <p-button
        icon="pi pi-home"
        [rounded]="true"
        severity="info"
        raised="true"
        size="large"
        (onClick)="backToHome()"
      />
    </div>

    <p-stepper [value]="1">
      <p-step-list>
        <p-step [value]="1">Selecionar datas</p-step>
        <p-step [value]="2">Termo de Consentimento</p-step>
        <p-step [value]="3">Assinatura</p-step>
        <p-step [value]="4">Pagamento</p-step>
      </p-step-list>

      <p-step-panels>
        <p-step-panel [value]="1">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="step step1">
              <!-- Conteúdo -->
              <div class="step-content">
                <div class="info-item">
                  <span class="label">Valores Atuais</span>
                  <div class="value">
                    <div class="value-row">
                      <i class="pi pi-dollar"></i>
                      <span
                        >Bruto:
                        {{ contract!.brutePrice | number : "1.2-2" }}</span
                      >
                    </div>

                    <div class="value-row">
                      <i class="pi pi-dollar"></i>
                      <span
                        >Desconto: -{{
                          contract!.descountFixe | number : "1.2-2"
                        }}</span
                      >
                    </div>

                    <div class="value-row">
                      <i class="pi pi-dollar"></i>
                      <span
                        >Líquido:
                        {{ contract!.liquidPrice | number : "1.2-2" }}</span
                      >
                    </div>
                  </div>
                </div>

                <div class="info-item">
                  <span class="label">Data de Assinatura / Início</span>
                  <span class="value">
                    {{ contract!.dateSignature | date : "dd/MM/yyyy" }} -
                    {{ contract!.dateStart | date : "dd/MM/yyyy" }}
                  </span>
                </div>

                <div class="info-item">
                  <span class="label">Vigência</span>
                  <span class="value">{{ contract!.vigencia }} meses</span>
                </div>

                <div class="info-item">
                  <span class="label">Ciclo de Faturamento</span>
                  <span class="value highlight">
                    Dia base: {{ contract!.cicleBillingDayBase }} / Dia de
                    Vencimento: {{ contract!.cicleBillingExpired }}
                  </span>
                </div>

                <div class="select-wrapper">
                  <p-select
                    [options]="typesOfDateExpirationCicle"
                    optionLabel="descricao"
                    optionValue="value"
                    placeholder="Selecione nova data de vencimento"
                    styleClass="custom-select"
                    [(ngModel)]="selectedBillingCycle"
                    (onChange)="onBillingCycleChange()"
                  ></p-select>
                </div>

                <div class="selected-info" *ngIf="selectedBillingCycle">
                  <i class="pi pi-calendar"></i>
                  <span>
                    Novo dia base selecionado:
                    {{ selectedBillingCycle }}
                  </span>
                </div>

                <div class="proportional-explanation">
                  <p>
                    O valor abaixo é calculado proporcionalmente ao período
                    restante do mês atual. Considera-se o valor líquido do
                    contrato dividido pela quantidade de dias [30], multiplicado
                    pelo número de dias até o novo dia base escolhido.
                  </p>
                </div>

                <div
                  class="proportional-info"
                  *ngIf="proportionalBoleto !== null"
                >
                  <i class="pi pi-dollar"></i>
                  <span>
                    Valor Proporcional:
                    {{
                      proportionalBoleto | currency : "BRL" : "symbol" : "1.2-2"
                    }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Botão próximo -->
            <div class="btn-actions">
              <p-button
                severity="success"
                rounded="true"
                raised="true"
                size="large"
                icon="pi pi-arrow-right"
                iconPos="right"
                label="Próximo"
                (onClick)="activateCallback(2)"
                [disabled]="!selectedBillingCycle"
              ></p-button>
            </div>
          </ng-template>
        </p-step-panel>

        <p-step-panel [value]="2">
          <ng-template #content>
            <div *ngIf="selectedBillingCycle; else noDateSelected">
              <!-- Conteúdo real do passo 2 -->
              <p>Termo de Consentimento: Verificar questões de assinatura, abertura de atendimento no rbx , inclusão da imagem lá, salvar a imagem aqui e boa..</p>

              <div class="btn-actions">
                <!-- Visualizar / Baixar PDF -->
                <p-button
                  label="Visualizar PDF"
                  icon="pi pi-file-pdf"
                  severity="success"
                  [raised]="true"
                  rounded="true"
                  (onClick)="getConsentTermPdf()"
                ></p-button>

                <!-- Enviar via WhatsApp -->
                <p-button
                  label="Enviar WhatsApp"
                  icon="pi pi-whatsapp"
                  severity="info"
                  rounded="true"
                  [raised]="true"
                  (onClick)="enviarWhatsapp()"
                ></p-button>

                <!-- Enviar para API autenticada -->
                <p-button
                  label="Autentique"
                  icon="pi pi-send"
                  severity="warn"
                  rounded="true"
                  [raised]="true"
                  (onClick)="enviarApi()"
                ></p-button>
              </div>
            </div>

            <ng-template #noDateSelected>
              <div class="alert-warning">
                ⚠️ Para acessar este passo, volte ao passo anterior e selecione
                a nova data de vencimento.
              </div>
            </ng-template>
          </ng-template>
        </p-step-panel>

        <p-step-panel [value]="3">
          <!-- Conteúdo da etapa 3 -->
        </p-step-panel>

        <p-step-panel [value]="4">
          <!-- Conteúdo da etapa 4 -->
        </p-step-panel>
      </p-step-panels>
    </p-stepper>
  </app-card-base>
</div>
