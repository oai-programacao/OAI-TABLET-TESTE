<div class="panel-container">
  <app-card-base header="Transfer√™ncia De Endere√ßo" width="auto" height="auto">
    <div class="btn-to-back">
      <p-button
        icon="pi pi-arrow-left"
        [rounded]="true"
        severity="danger"
        (onClick)="btnToBack()"
      />
    </div>
    <div class="content">
      <p-stepper [value]="1">
        <p-step-list>
          <p-step [value]="1">Endere√ßo</p-step>
          <p-step [value]="2">Termo de Consentimento</p-step>
          <p-step [value]="3">Assinatura</p-step>
          <p-step [value]="4">Pagamento</p-step>
        </p-step-list>
        <p-step-panels>
          <p-step-panel [value]="1">
            <ng-template #content let-activateCallback="activateCallback">
              <div>
                <p-divider>
                  <h1 class="title-address-form">Endere√ßo Atual</h1>
                </p-divider>
              </div>

              <div class="form-container">
                <div class="form-content">
                  <div class="input-content">
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-map-marker"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          type="text"
                          [mask]="'00000-000'"
                          pInputText
                          [ngModel]="currentContract?.zipCode"
                          disabled
                        />
                        <label for="CEP">CEP:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <div class="input-content">
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-home"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          type="text"
                          pInputText
                          [ngModel]="currentContract?.street"
                          disabled
                        />
                        <label for="address-street">Logradouro:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <div class="input-content">
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-bell"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          type="text"
                          pInputText
                          [ngModel]="currentContract?.number"
                          disabled
                        />
                        <label for="address-number">N¬∞ Casa/Apartamento:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <div class="input-content">
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-building"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          type="text"
                          id="address-complement"
                          pInputText
                          [ngModel]="currentContract?.complement"
                          disabled
                        />
                        <label for="address-complement">Complemento:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <!-- Cidade -->
                  <div class="input-content">
                    <p-inputgroup>
                      <p-inputgroup-addon
                        ><i class="pi pi-paperclip"></i
                      ></p-inputgroup-addon>
                      <p-iftalabel variant="on">
                        <input
                          pInputText
                          id="cidade"
                          name="cidade"
                          [ngModel]="currentContract?.city"
                          #cidade="ngModel"
                          disabled
                        />
                        <label for="cidade">Cidade:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <div class="input-content">
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-map-marker"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          type="text"
                          [mask]="'AA'"
                          pInputText
                          [ngModel]="currentContract?.state"
                          disabled
                        />
                        <label for="UF">UF:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <div class="text-area-content">
                    <p-iftalabel>
                      <textarea
                        style="width: 100%; height: auto"
                        placeholder="Observa√ß√µes"
                        disabled
                        rows="5"
                        cols="20"
                        pTextarea
                        [autoResize]="true"
                        [value]="currentContract?.observation"
                      ></textarea>
                      <label for="observation">Observa√ß√£o:</label>
                    </p-iftalabel>
                  </div>
                </div>
              </div>

              <div>
                <p-divider>
                  <h1 class="title-address-form">Endere√ßo Novo</h1>
                </p-divider>
              </div>

              <form #addressNewNgForm="ngForm" class="form-container">
                <div class="form-content">
                  <!-- CEP -->
                  <div class="input-content">
                    <div class="msg-error">
                      <app-message-valid-forms
                        [control]="cep"
                        error="required"
                        text="O CEP √© obrigat√≥rio"
                      ></app-message-valid-forms>
                    </div>
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-map-marker"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          id="CEP"
                          name="cep"
                          type="text"
                          pInputText
                          [mask]="'00000-000'"
                          [(ngModel)]="addressNewForm.cep"
                          #cep="ngModel"
                          required
                        />
                        <label for="CEP">CEP:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <!-- Logradouro -->
                  <div class="input-content">
                    <div class="msg-error">
                      <app-message-valid-forms
                        [control]="street"
                        error="required"
                        text="Campo obrigat√≥rio"
                      ></app-message-valid-forms>
                    </div>
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-home"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          id="address-street"
                          name="street"
                          type="text"
                          pInputText
                          [(ngModel)]="addressNewForm.street"
                          #street="ngModel"
                          required
                        />
                        <label for="address-street">Logradouro:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <!-- N√∫mero -->
                  <div class="input-content">
                    <div class="msg-error">
                      <app-message-valid-forms
                        [control]="numberFromHome"
                        error="required"
                        text="Campo obrigat√≥rio"
                      ></app-message-valid-forms>
                    </div>
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-bell"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          id="address-number"
                          name="numberFromHome"
                          type="text"
                          pInputText
                          [(ngModel)]="addressNewForm.numberFromHome"
                          #numberFromHome="ngModel"
                          required
                        />
                        <label for="address-number">N¬∞ Casa/Apartamento:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <!-- Complemento -->
                  <div class="input-content">
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-building"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          id="address-complement"
                          name="complement"
                          type="text"
                          pInputText
                          [(ngModel)]="addressNewForm.complement"
                          #complement="ngModel"
                        />
                        <label for="address-complement">Complemento:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>
                  <!-- Cidade -->
                  <div class="input-content">
                    <p-inputgroup>
                      <p-inputgroup-addon
                        ><i class="pi pi-paperclip"></i
                      ></p-inputgroup-addon>
                      <p-iftalabel variant="on">
                        <input
                          pInputText
                          id="cidade"
                          name="cidade"
                          [(ngModel)]="addressNewForm.city"
                          #cidade="ngModel"
                        />
                        <label for="cidade">Cidade</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <!-- UF -->
                  <div class="input-content">
                    <div class="msg-error">
                      <app-message-valid-forms
                        [control]="uf"
                        error="required"
                        text="UF √© obrigat√≥rio"
                      ></app-message-valid-forms>
                    </div>
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <i class="pi pi-map-marker"></i>
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          id="UF"
                          name="uf"
                          type="text"
                          pInputText
                          [mask]="'AA'"
                          [(ngModel)]="addressNewForm.uf"
                          #uf="ngModel"
                          required
                        />
                        <label for="UF">UF:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <!-- Observa√ß√£o -->
                  <div class="text-area-content">
                    <p-iftalabel>
                      <textarea
                        id="observation"
                        name="observation"
                        pTextarea
                        [autoResize]="true"
                        rows="5"
                        cols="30"
                        [(ngModel)]="addressNewForm.observation"
                        #observation="ngModel"
                        style="width: 100%"
                      ></textarea>
                      <label for="observation">Observa√ß√£o:</label>
                    </p-iftalabel>
                  </div>

                  <!-- ADESAO -->
                  <p-inputgroup>
                    <p-inputgroup-addon>R$</p-inputgroup-addon>
                    <p-inputNumber
                      name="adesionValue"
                      placeholder="Valor de Ades√£o"
                      mode="decimal"
                      [minFractionDigits]="2"
                      [maxFractionDigits]="2"
                      [(ngModel)]="addressNewForm.adesionValue"
                      #adesionValue="ngModel"
                      required
                    ></p-inputNumber>
                  </p-inputgroup>
                </div>
              </form>
              <div class="btn-actions">
                <p-button
                  label="Verificar Oferta"
                  size="large"
                  severity="info"
                  icon="pi pi-check"
                  (click)="openDialog()"
                />
                <p-button
                  label="Verificar Cabeamento"
                  size="large"
                  severity="warn"
                  icon="pi pi-wifi"
                />
                <p-button
                  severity="success"
                  label="Pr√≥ximo"
                  size="large"
                  (onClick)="activateCallback(2)"
                  [disabled]="!addressNewNgForm.valid"
                />
              </div>
            </ng-template>
          </p-step-panel>

          <p-step-panel [value]="2">
            <ng-template #content let-activateCallback="activateCallback">
              <div *ngIf="addressNewNgForm.valid; else formInvalido">
                <!-- Conte√∫do real do passo 2 -->
                <p class="step2-info">
                  üìå <strong>Op√ß√µes de envio do termo:</strong><br />
                  - Para apenas visualizar o termo, utilize
                  <strong>Visualizar PDF</strong>.<br />
                  - Caso a comunica√ß√£o com o cliente seja por WhatsApp, utilize
                  a op√ß√£o <strong>Autentique</strong> para enviar o documento
                  para assinatura.
                </p>
                <div class="btn-actions">
                  <p-button
                    label="Visualizar PDF"
                    icon="pi pi-file-pdf"
                    severity="success"
                    [raised]="true"
                    (onClick)="getConsentTermAddressPdf()"
                    [loading]="isLoading"
                  ></p-button>
                  <p-button
                    label="Autentique"
                    icon="pi pi-send"
                    severity="warn"
                    [raised]="true"
                    (onClick)="abrirModal()"
                  ></p-button>
                </div>
              </div>
              <ng-template #formInvalido>
                <div class="alert-warning">
                  ‚ö†Ô∏è Para prosseguir, volte ao passo anterior e preencha todos
                  os campos obrigat√≥rios.
                </div>
              </ng-template>
            </ng-template>
          </p-step-panel>

          <p-step-panel [value]="3">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="signature-pad-container">
                <div class="signature-input">
                  <p-iftalabel style="width: 100%">
                    <label for="signature">Assinatura:</label>
                    <textarea
                      style="width: 100%; height: 100%"
                      [autoResize]="true"
                      rows="5"
                      cols="30"
                      pTextarea
                    ></textarea>
                  </p-iftalabel>
                </div>
                <div class="btn-to-capture">
                  <div class="btn-to-signature">
                    <p-button
                      label="Capturar Assinatura"
                      size="large"
                      severity="success"
                      variant="outlined"
                    />
                    <p-button
                      label="Cancelar"
                      severity="danger"
                      size="large"
                      variant="outlined"
                    />
                  </div>
                  <div class="btn-to-generate-contract">
                    <p-button
                      label="Gerar Contrato"
                      [outlined]="true"
                      size="large"
                      severity="info"
                      variant="outlined"
                    />
                  </div>
                </div>

                <div class="btn-to-navigate">
                  <p-button
                    label="Voltar"
                    severity="danger"
                    size="large"
                    (onClick)="activateCallback(2)"
                  />
                  <p-button
                    label="Pr√≥ximo"
                    severity="success"
                    size="large"
                    (onClick)="activateCallback(4)"
                  />
                </div>
              </div>
            </ng-template>
          </p-step-panel>

          <p-step-panel [value]="4">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="payment-container">
                <form #paymentNgForm="ngForm" class="payment-content">
                  <div class="input-content">
                    <div class="msg-error">
                      <app-message-valid-forms
                        [control]="title"
                        error="required"
                        text="Campo Obrigat√≥rio"
                      ></app-message-valid-forms>
                    </div>
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <span class="material-symbols-outlined"
                          >attach_money</span
                        >
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          [(ngModel)]="paymentForm.title"
                          #title="ngModel"
                          name="title"
                          id="title"
                          pInputText
                          required
                        />
                        <label for="title">T√≠tulo:</label>
                        <div></div>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <div class="input-content">
                    <div class="msg-error">
                      <app-message-valid-forms
                        [control]="dueDate"
                        error="required"
                        text="Campo Obrigat√≥rio"
                      ></app-message-valid-forms>
                    </div>
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <span class="material-symbols-outlined"
                          >calendar_clock</span
                        >
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          [(ngModel)]="paymentForm.dueDate"
                          #dueDate="ngModel"
                          name="dueDate"
                          id="due-date"
                          pInputText
                          required
                        />
                        <label for="due-date">Data de Vencimento:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>

                  <div class="input-content">
                    <div class="msg-error">
                      <app-message-valid-forms
                        [control]="price"
                        error="required"
                        text="Campo Obrigat√≥rio"
                      ></app-message-valid-forms>
                    </div>
                    <p-inputgroup>
                      <p-inputgroup-addon>
                        <span class="material-symbols-outlined"
                          >attach_money</span
                        >
                      </p-inputgroup-addon>
                      <p-iftalabel>
                        <input
                          [(ngModel)]="paymentForm.price"
                          #price="ngModel"
                          name="price"
                          id="price"
                          pInputText
                          prefix="R$"
                          thousandSeparator="."
                          decimalMarker=","
                          [mask]="'separator.2'"
                          required
                        />
                        <label for="price">Valor:</label>
                      </p-iftalabel>
                    </p-inputgroup>
                  </div>
                </form>
                <div class="btn-actions-payment">
                  <p-button
                    label="Gerar Boleto"
                    [outlined]="true"
                    size="large"
                    severity="info"
                    icon="pi pi-file"
                  ></p-button>
                  <p-button
                    label="Enviar Por Whatsapp"
                    size="large"
                    [outlined]="true"
                    severity="success"
                    icon="pi pi-whatsapp"
                  ></p-button>
                </div>
                <div class="btn-to-navigate">
                  <p-button
                    label="Voltar"
                    size="large"
                    severity="danger"
                    (onClick)="activateCallback(3)"
                  />
                  <p-button
                    label="Concluir"
                    size="large"
                    icon="pi pi-check"
                    severity="success"
                    (onClick)="sendToAutomation()"
                  />
                </div>
              </div>
            </ng-template>
          </p-step-panel>
        </p-step-panels>
      </p-stepper>
    </div>
  </app-card-base>
</div>

<p-dialog
  header="Enviar Via WhatsApp ‚öôÔ∏è"
  [(visible)]="modalVisible"
  [modal]="true"
  [closable]="true"
  [resizable]="false"
  [draggable]="false"
>
  <div class="dialog-content">
    <div class="icon-container">
      <i class="pi pi-whatsapp whatsapp-icon"></i>
    </div>
    <p class="info-text">
      O termo ser√° enviado pela <strong>Autentique</strong> para o cliente
      assinar via WhatsApp. Digite o n√∫mero com DDD.
    </p>
    <p-inputgroup>
      <p-inputgroup-addon>+55</p-inputgroup-addon>
      <input
        pInputText
        id="telefone"
        name="telefone"
        placeholder="(DDD) 00000-0000"
        [(ngModel)]="phone"
        required
        mask="(00) 00000-0000"
      />
    </p-inputgroup>
  </div>
  <ng-template pTemplate="footer">
    <p-button
      label="Cancelar"
      icon="pi pi-times"
      severity="secondary"
      (onClick)="fecharModal()"
    ></p-button>
    <p-button
      label="Enviar"
      icon="pi pi-send"
      severity="success"
      [disabled]="!phone || phone.length < 10"
      [loading]="isLoading"
    ></p-button>
  </ng-template>
</p-dialog>

<p-dialog
  header="Verificar Oferta"
  [(visible)]="displayDialog"
  [modal]="true"
  [style]="{ width: '35rem' }"
  [draggable]="false"
  [resizable]="false"
>
  <div class="dialog-form-container">
    <div class="form-field">
      <p-inputgroup>
        <p-inputgroup-addon><i class="pi pi-home"></i></p-inputgroup-addon>
        <p-iftalabel>
          <input [ngModel]="currentContract?.street" pInputText disabled />
          <label for="current-address">Endere√ßo Atual:</label>
        </p-iftalabel>
      </p-inputgroup>
    </div>

    <div class="form-field">
      <p-inputgroup>
        <p-inputgroup-addon><i class="pi pi-home"></i></p-inputgroup-addon>
        <p-iftalabel>
          <input [(ngModel)]="addressNewForm.street" pInputText disabled />
          <label for="current-address">Endere√ßo Novo:</label>
        </p-iftalabel>
      </p-inputgroup>
    </div>

    <div class="form-field-full">
      <label>Observa√ß√µes</label>
      <textarea
        style="width: 100%"
        rows="8"
        cols="54"
        style="resize: none"
        pTextarea
      ></textarea>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <div class="btn-to-navigate">
      <p-button
        label="Voltar"
        icon="pi pi-arrow-left"
        severity="danger"
        size="large"
        (click)="closeDialog()"
      />
    </div>
  </ng-template>
</p-dialog>
