<div class="page-container">
  <app-card-base>
    <div class="card">
      <p-stepper [value]="1">
        <p-step-item [value]="1">
          <p-step>• Dados do Contrato </p-step>
          <p-step-panel>
            <ng-template #content let-activateCallback="activateCallback">
              <div class="space-stepper1">
                <p-inputgroup>
                  <p-inputgroup-addon>
                    <i class="pi pi-ticket"></i>
                  </p-inputgroup-addon>
                  <p-iftalabel>
                    <p-select
                      [options]="plans"
                      optionLabel="label"
                      optionValue="value"
                      placeholder="Selecione"
                      name="planos"
                      required
                    >
                    </p-select>
                    <label for="planos">Plano de Internet*</label>
                  </p-iftalabel>
                </p-inputgroup>

                <div>
                  <p-inputgroup>
                    <p-inputgroup-addon>
                      <i class="pi pi-dollar"></i>
                    </p-inputgroup-addon>
                    <p-iftalabel variant="on">
                      <input
                        size="large"
                        pInputText
                        id="descount"
                        name="descount"
                        type="text"
                        required
                        maxlength="18"
                        [currencyMask]="{
                          prefix: 'R$ ',
                          thousands: '.',
                          decimal: ',',
                          align: 'left'
                        }"
                        inputmode="numeric"
                        pattern="[0-9]*"
                        placeholder="R$ 0,00"
                        [maxLength]="7"
                      />
                      <label for="descount">Desconto de Adesão*</label>
                    </p-iftalabel>
                  </p-inputgroup>
                </div>
              </div>

              <div class="space-stepper1">
                <p-iftalabel>
                  <p-datepicker
                    name="dateOfStart"
                    [(ngModel)]="dateOfStart"
                    inputId="date"
                    showIcon
                    iconDisplay="input"
                    appendTo="body"
                    #dateofStart="ngModel"
                    placeholder="dd/mm/aaaa"
                    required
                  />
                  <label for="date">Data de Início*</label>
                </p-iftalabel>

                <p-iftalabel>
                  <p-datepicker
                    name="dateOfAssignment"
                    [(ngModel)]="dateOfAssignment"
                    inputId="dateOfAssignment"
                    showIcon
                    iconDisplay="input"
                    appendTo="body"
                    #dateofAssignment="ngModel"
                    placeholder="dd/mm/aaaa"
                    required
                  />
                  <label for="date">Data de Assinatura*</label>
                </p-iftalabel>

                <div class="numbersOfInstallments">
                  <p-inputgroup>
                    <p-inputgroup-addon>
                      <i class="pi pi-sort-numeric-up"></i>
                    </p-inputgroup-addon>
                    <p-iftalabel>
                      <p-select
                        [options]="numbersOfInstallments"
                        [(ngModel)]="selectedInstallment"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Selecione 1x a 24x"
                        name="planos"
                        required
                      >
                      </p-select>
                      <label for="planos">Número de Parcelas Adesão</label>
                    </p-iftalabel>
                  </p-inputgroup>
                </div>
              </div>

              <div class="space-stepper2">
                <p-iftalabel>
                  <p-datepicker
                    name="dateOfExpiration"
                    [(ngModel)]="dateOfExpiration"
                    inputId="dateOfExpiration"
                    showIcon
                    iconDisplay="input"
                    appendTo="body"
                    #dateofExpiration="ngModel"
                    placeholder="dd/mm/aaaa"
                    required
                  ></p-datepicker>
                  <label for="dateOfExpiration">Dia de Vencimento*</label>
                </p-iftalabel>

                <p-inputgroup>
                  <p-inputgroup-addon>
                    <i class="pi pi-file"></i>
                  </p-inputgroup-addon>
                  <p-iftalabel>
                    <p-select
                      name="typesOfContractOptions"
                      [(ngModel)]="selectContract"
                      [options]="typesOfContractOptions"
                      placeholder="Selecione o tipo de contrato"
                      inputId="tipoContrato"
                      required
                    ></p-select>
                    <label for="tipoContrato">Tipo de Contrato*</label>
                  </p-iftalabel>
                </p-inputgroup>
              </div>

              <div class="warn-icon-container">
                <span
                  class="warn-icon"
                  (click)="toggle(pop, $event)"
                  role="button"
                  aria-label="Informação importante"
                >
                  !
                </span>

                <p-popover #pop [dismissable]="true">
                  <div class="warn-popup">
                    Este campo indica o dia selecionado pelo cliente para o
                    vencimento da taxa de adesão
                  </div>
                </p-popover>
              </div>

              <div class="space-stepper3">
                <p-iftalabel>
                  <p-datepicker
                    name="dateOfMemberShipExpiration"
                    [(ngModel)]="dateOfMemberShipExpiration"
                    inputId="dateOfMemberShipExpiration"
                    showIcon
                    iconDisplay="input"
                    appendTo="body"
                    #dateofExpiration="ngModel"
                    placeholder="dd/mm/aaaa"
                    required
                  ></p-datepicker>
                  <label for="dateOfMemberShipExpiration"
                    >Data de Vencimento da Adesão*</label
                  >
                </p-iftalabel>
              </div>

              <p-divider></p-divider>
              <div class="warn-icon-container">
                <span
                  class="warn-icon"
                  (click)="toggle(pop2, $event)"
                  role="button"
                  aria-label="Informação importante"
                >
                  !
                </span>

                <p-popover #pop2 [dismissable]="true">
                  <div class="warn-popup">
                    Escolha fotos de sua galeria, tire novas fotos e lembre-se
                    de que as imagens devem ser nítidas, legíveis e realmente
                    necessárias!
                  </div>
                </p-popover>
              </div>
              <p class="header-title">Upload de Imagens do Contrato</p>

              <div class="title-image-upload">
                <input
                  type="file"
                  #fileInput
                  accept="image/*"
                  (change)="onFileSelected($event)"
                  hidden
                />
              </div>

              <div class="image-upload-row">
                <div class="image-slot" *ngFor="let slot of [0, 1, 2, 3, 4]">
                  <span
                    *ngIf="!images[slot]"
                    class="plus-icon"
                    (click)="fileInput.click()"
                    >+</span
                  >

                  <div *ngIf="images[slot]" class="image-preview">
                    <img
                      [src]="images[slot]"
                      alt="Imagem {{ slot + 1 }}"
                      (dblclick)="viewImage(images[slot]!)"
                    />

                    <button
                      type="button"
                      class="remove-btn"
                      (click)="removeImage(slot)"
                    >
                      ✕
                    </button>
                  </div>
                </div>
              </div>

              <!-- Dialog para visualização de imagem -->
              <p-dialog
                [(visible)]="previewVisible"
                [modal]="true"
                [style]="{ width: '90vw' }"
              >
                <img
                  *ngIf="previewImage"
                  [src]="previewImage"
                  alt="Preview"
                  class="preview-dialog-img"
                />
              </p-dialog>

              <div class="button-content">
                <p-button
                  label="Próximo"
                  icon="pi pi-arrow-down"
                  iconPos="right"
                  (onClick)="activateCallback(2)"
                  [severity]="'secondary'"
                  [raised]="true"
                />
              </div>
            </ng-template>
          </p-step-panel>
        </p-step-item>

        <p-step-item [value]="2">
          <p-step>• Endereço do Contrato </p-step>
          <p-step-panel>
            <ng-template #content let-activateCallback="activateCallback">
              <div class="space-stepper1">
                <p-inputgroup>
                  <p-inputgroup-addon>
                    <i class="pi pi-map-marker"></i>
                  </p-inputgroup-addon>
                  <p-iftalabel variant="on">
                    <input
                      size="large"
                      pInputText
                      id="cep"
                      autocomplete="off"
                      maxlength="9"
                      name="cep"
                      required
                      placeholder="00000-000"
                      [mask]="'00000-000'"
                    />
                    <label for="cep">Código de Endereço Postal (CEP)*</label>
                  </p-iftalabel>
                </p-inputgroup>

                <p-inputgroup>
                  <p-inputgroup-addon>
                    <i class="pi pi-map-marker"></i>
                  </p-inputgroup-addon>
                  <p-iftalabel variant="on">
                    <input
                      size="large"
                      pInputText
                      id="street"
                      autocomplete="off"
                      maxlength="60"
                      name="street"
                      required
                    />
                    <label for="cep">Logradouro (Rua)*</label>
                  </p-iftalabel>
                </p-inputgroup>

                <p-inputgroup>
                  <p-inputgroup-addon>
                    <i class="pi pi-sort-numeric-up-alt"></i>
                  </p-inputgroup-addon>
                  <p-iftalabel variant="on">
                    <input
                      size="large"
                      pInputText
                      type="number"
                      id="street"
                      autocomplete="off"
                      maxlength="60"
                      name="street"
                      required
                    />
                    <label for="cep">Número do Prédio*</label>
                  </p-iftalabel>
                </p-inputgroup>
              </div>

              <div class="space-stepper1">
                <p-inputgroup>
                  <p-inputgroup-addon>
                    <i class="pi pi-building"></i>
                  </p-inputgroup-addon>
                  <p-iftalabel>
                    <p-select
                      name="typeOfResidenceOptions"
                      [(ngModel)]="selectedResidence"
                      [options]="typeOfResidenceOptions"
                      placeholder="Selecione o tipo de residência"
                      inputId="typeResidence"
                      required
                    ></p-select>
                    <label for="typeResidence">Tipo de Residência*</label>
                  </p-iftalabel>
                </p-inputgroup>

                <p-inputgroup>
                  <p-inputgroup-addon>
                    <i class="pi pi-map-marker"></i>
                  </p-inputgroup-addon>
                  <p-iftalabel variant="on">
                    <input
                      size="large"
                      pInputText
                      id="neighborhood"
                      autocomplete="off"
                      maxlength="60"
                      name="neighborhood"
                      required
                    />
                    <label for="neighborhood">Bairro*</label>
                  </p-iftalabel>
                </p-inputgroup>

                <p-inputgroup>
                  <p-inputgroup-addon>
                    <i class="pi pi-map-marker"></i>
                  </p-inputgroup-addon>
                  <p-iftalabel variant="on">
                    <input
                      size="large"
                      pInputText
                      id="cityaddress"
                      autocomplete="off"
                      maxlength="60"
                      name="cityaddress"
                      required
                    />
                    <label for="cityaddress">Cidade*</label>
                  </p-iftalabel>
                </p-inputgroup>
              </div>

              <div class="space-stepper1">
                <p-inputgroup>
                  <p-inputgroup-addon>
                    <i class="pi pi-map-marker"></i>
                  </p-inputgroup-addon>
                  <p-iftalabel variant="on">
                    <input
                      size="large"
                      pInputText
                      id="complementaddress"
                      autocomplete="off"
                      maxlength="60"
                      name="complementaddress"
                      required
                    />
                    <label for="complementaddress">Complemento*</label>
                  </p-iftalabel>
                </p-inputgroup>
              </div>

              <div class="space-stepper1">
                <p-button
                  [size]="'large'"
                  label="Validar Cabeamento"
                  raised="true"
                  severity="warn"
                  icon="pi pi-sliders-h"
                  (onClick)="showMapDialog = true"
                />
              </div>

              <div class="space2-stepper">
                <p-iftalabel>
                  <textarea
                    pTextarea
                    id="description"
                    rows="5"
                    cols="100"
                    style="resize: none"
                  ></textarea>
                  <label for="description">Observação</label>
                </p-iftalabel>
              </div>

              <p-dialog
                [(visible)]="showMapDialog"
                [modal]="true"
                [style]="{ width: '90vh', height: '65vh' }"
              >
                <app-google-maps [address]="fullAddress"></app-google-maps>
              </p-dialog>

              <div class="button-content">
                <p-button
                  [size]="'large'"
                  label="Visualizar O.S"
                  raised="true"
                  severity="warn"
                  icon="pi pi-bell"
                  (onClick)="showMapDialog = true"
                />
                <p-button
                  [size]="'large'"
                  label="Solicitar O.S"
                  raised="true"
                  severity="warn"
                  icon="pi pi-bell"
                  (onClick)="showMapDialog = true"
                />
                <p-button
                  [size]="'large'"
                  label="Google Maps"
                  raised="true"
                  severity="info"
                  icon="pi pi-globe"
                  (onClick)="showMapDialog = true"
                />
                <p-button
                  [size]="'large'"
                  label="Voltar"
                  raised="true"
                  severity="secondary"
                  icon="pi pi-arrow-up"
                  (onClick)="activateCallback(1)"
                />
                <p-button
                  [size]="'large'"
                  raised="true"
                  label="Próximo"
                  icon="pi pi-arrow-down"
                  iconPos="right"
                  (onClick)="activateCallback(3)"
                />
              </div>
            </ng-template>
          </p-step-panel>
        </p-step-item>

        <p-step-item [value]="3">
          <p-step>• Assinatura Digital </p-step>
          <p-step-panel>
            <ng-template #content let-activateCallback="activateCallback">
              <div class="space-stepper1">
                <div
                  class="border-2 border-dashed rounded flex-auto flex justify-center items-center"
                >
                  Conteúdo: Assinatura Digital
                  <app-signature-pad
                    (signatureData)="onSignatureData($event)"
                  ></app-signature-pad>
                </div>
              </div>
              <div class="flex py-6 justify-between">
                <p-button
                  label="Voltar"
                  severity="secondary"
                  icon="pi pi-arrow-left"
                  (onClick)="activateCallback(2)"
                />
                <p-button
                  label="Próximo"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  (onClick)="activateCallback(4)"
                />
              </div>
            </ng-template>
          </p-step-panel>
        </p-step-item>

        <p-step-item [value]="4">
          <p-step>• Visualização do Contrato </p-step>
          <p-step-panel>
            <ng-template #content let-activateCallback="activateCallback">
              <div class="flex flex-col h-48">
                <div
                  class="border-2 border-dashed rounded flex-auto flex justify-center items-center"
                >
                  Conteúdo: Visualização do Contrato
                </div>
              </div>
              <div class="py-6 flex justify-start">
                <p-button
                  label="Voltar"
                  severity="secondary"
                  icon="pi pi-arrow-left"
                  (onClick)="activateCallback(3)"
                />
              </div>
            </ng-template>
          </p-step-panel>
        </p-step-item>
      </p-stepper>
    </div>
  </app-card-base>
</div>
